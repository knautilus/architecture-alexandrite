## Проблемы системы

1. Медленный расчет стоимости
Расчет стоимости выполняется синхронно. Скорость расчёта стоимости зависит от количества полигонов в 3D-модели и в среднем занимает 2-3 минуты. Если модель сложная и детализированная, время обработки может достигать 30 минут.

2. Застревание заказов
Клиенты жалуются менеджерам по продажам, что они не получили заказ и над их изделием работают уже несколько месяцев, хотя обещали закончить за три недели.
Вероятно, происходит потеря сообщений в RabbitMQ.

3. Долгая загрузка дашборда MES
Участились жалобы от операторов: когда они заходят на первую страницу MES, система долго прогружается. На первой странице отображается список заказов в работе по статусам — это дашборд. Команда сделала фильтр по статусам и пагинацию, но это не помогло.

4. Отсутствие масштабирования
Каждое приложение имеет по одному инстансу. Базы данных имеют один инстанс, который работает на запись и на чтение.

5. Ручной прогон E2E тестов
QA-инженер прогоняет E2E-сценарии вручную. Если он обнаруживает баги уровня high или highest, то версию не деплоят на продакшн до их починки. Это часто приводит к значительным задержкам релиза.

## Пути решения (инициативы)

1. Внедрение мониторинга, логирования, трейсинга
Судя по тому, что нельзя точно сказать, в чем причина застревания заказов и медленной загрузки дашборда MES, у системы есть проблемы с Observability.
Внедрение мониторинга, логирования, трейсинга поможет в обнаружении причин проблем, а также в понимании, насколько эффективны будут принимаемые решения.

2. Улучшение работы с RabbitMQ
Добавить мониторинг очередей RabbitMQ для отслеживания задержек и зависших сообщений.
Внедрить механизм Retry для повторной отправки сообщений и Dead-Letter-Exchange для анализа причин неудачной обработки.

3. Оптимизация дашборда
Необходимо оптимизировать SQL-запросы к MES DB, добавить индексы для полей, по которым происходит фильтрация. Реализовать кэширование списка заказов.

4. Оптимизация расчета стоимости
Необходимо выделить отдельный бэкграунд сервис для длительных расчетов MES. Перевести расчёт стоимости на асинхронную обработку с использованием RabbitMQ.
Также необходимо оптимизировать алгоритмы расчетов.

5. Масштабирование сервисов
Мониторинг, анализ метрик и производственных мощностей позволит сделать вывод о необходимости горизонтального масштабирования системы.
При достижении определенных метрик нужно разворачивать дополнительный инстанс необходимого сервиса.
Выделить отдельные инстансы БД для чтения и записи.

6. Автоматизация тестирования
Необходимо внедрить автоматизированное E2E-тестирование.

## Целевая архитектура через полгода

- У системы выполняется принцип Observability, что способствует быстрому обнаружению и решению проблем.
- Интеграция CRM и MES работает через RabbitMQ с гарантированной доставкой.
- Реализован отдельный сервис расчёта стоимости, убирающий нагрузку с MES.
- Сервисы горизонтально масштабируются.
- Внедрено автоматизированное тестирование.

Наивысший приоритет - у первых трех инициатив.
1. Способствует быстрому обнаружению и решению проблем
2. Устраняет большую часть причин жалоб клиентов
3. Устраняет внутренние проблемы и ускоряет выполнение заказов