## Мотивация

Проблемные места:
- MES - медленная загрузка дашборда заказов
- расчет стоимости заказа - длительная обработка из-за сложности 3D-моделей

Кеширование позволит снизить нагрузку на базы данных, ускорить загрузку данных для отображения пользователям и обеспечит стабильность работы при пиковых нагрузках. Это приведет к уменьшению задержек в работе и улучшению пользовательского опыта, что в результате положительно скажется на финансовых результатах компании.

Будем внедрять кеширование в первую очередь в MES API, т.к. именно у него сейчас наибольшие проблемы со скоростью работы. Также будем кешировать данные в CRM API и Shop API.

Данные для кэширования:
- списки заказов
- справочники
- результаты расчета стоимости заказа (для повторного запроса)
- статические данные (каталог изделий в магазине)

## Предлагаемое решение

В качестве паттерна для серверного кеширования выбран Cache-Aside по следующим причинам:
- паттерн простой в исполнении
- устойчив к сбоям кеша
- в кеш записываются только данные, которые запрашиваются
- настройка инвалидации кеша обеспечит консистентность

Write-Through - ненужная задержка при записи данных, пока кеш обновляет базу данных

Refresh-Ahead - сложнее внедрять, избыточен

### Диаграмма последовательности действий

[Диаграмма последовательности](Sequence_diagram.png)

### Стратегия инвалидации кеша

Предлагается сочетать временную инвалидацию (по TTL) и инвалидацию по ключу

1. Временная инвалидация:
- для списков заказов TTL = 10 минут
- для расчета стоимости TTL = 60 минут (данные статичны после расчета)
- для справочников и каталога изделий TTL = 60 минут

2. Инвалидация по ключу:
При изменении статуса заказа удаляются ключи, связанные со старым статусом и новым

Програмная инвалидация списка заказов по ключу позволит точечно обновлять данные, а временная инвалидация будет страховочной мерой.

Не нужно инвалидировать кеш при каждом запросе данных, поэтому инвалидация, основанная на запросах, не подходит.